const fs = require('fs');
const path = require('path');
const matter = require('gray-matter');

// Paths
const postsDirectory = path.join(__dirname, '../src/posts');
const outputFile = path.join(__dirname, '../src/data/blogPosts.ts');

// Ensure data directory exists
const dataDirectory = path.dirname(outputFile);
if (!fs.existsSync(dataDirectory)) {
  fs.mkdirSync(dataDirectory, { recursive: true });
}

// Read markdown files and generate blog post data
function generateBlogData() {
  try {
    console.log('üîç Reading blog posts from:', postsDirectory);

    // Get all markdown files
    const fileNames = fs.readdirSync(postsDirectory)
      .filter(name => name.endsWith('.md'));

    console.log(`üìù Found ${fileNames.length} blog posts`);

    const posts = fileNames.map(fileName => {
      const slug = fileName.replace(/\.md$/, '');
      const fullPath = path.join(postsDirectory, fileName);
      const fileContents = fs.readFileSync(fullPath, 'utf8');

      // Parse frontmatter and content
      const { data, content } = matter(fileContents);

      return {
        slug,
        title: data.title || '',
        description: data.description || '',
        date: data.date || '',
        category: data.category || '',
        timeToRead: data.timeToRead || '',
        tags: data.tags || [],
        content: content.trim()
      };
    });

    // Generate TypeScript file
    const tsContent = `// This file is auto-generated by scripts/generate-blog-data.js
// Do not edit manually - changes will be overwritten

export interface BlogPost {
  slug: string;
  title: string;
  description: string;
  date: string;
  category: string;
  timeToRead: string;
  tags: string[];
  content: string;
}

export const blogPostsData: BlogPost[] = ${JSON.stringify(posts, null, 2)};
`;

    fs.writeFileSync(outputFile, tsContent);
    console.log('‚úÖ Generated blog data at:', outputFile);
    console.log(`üìä Generated data for ${posts.length} posts`);

  } catch (error) {
    console.error('‚ùå Error generating blog data:', error);
    process.exit(1);
  }
}

// Run the script
generateBlogData(); 